<!DOCTYPE html>
<html>
<head>
 <head>
    <title>User Aircraft Position</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <style>
      html, body, #map-canvas {
        height: 100%;
        margin: 0px;
        padding: 0px
      }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>

    <script>

// Returns a rotated image. Used for displaying plane icon pointing to correct heading
function drawRotated(canvas, image, degrees){
	var ctx = canvas.getContext('2d');
	ctx.clearRect(0,0,canvas.width,canvas.height);
	ctx.save();
	ctx.translate(canvas.width/2,canvas.height/2);
	ctx.rotate(degrees*Math.PI/180);
	ctx.drawImage(image,-image.width/2,-image.width/2);
	ctx.restore();
	return canvas.toDataURL("image/png");
}

var map;
var marker;
var airplaneIcons = new Array();

function initialize() {

	var img = new Image();
	img.onload = function(){
		var canvas = document.getElementById('icon');
		//ar ctx = can.getContext('2d');
		airplaneIcons[0] = img;
		airplaneIcons[360] = img;
		for (var i=1; i < 360; i++) {
			airplaneIcons[i] = drawRotated(canvas, img, i);
		}
		
		var mapOptions = {
			zoom: 7,
			mapTypeId: google.maps.MapTypeId.ROADMAP,
			center: new google.maps.LatLng(49.676344124391761, 9.128839612106174)
		};
	
		map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
		marker = new google.maps.Marker({
			position: new google.maps.LatLng(49.676344124391761, 9.128839612106174),
			map: map,
			title: 'FSX',
			icon: airplaneIcons[0]
		});
	}
	img.src = 'data:image/png;base64,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';
}

google.maps.event.addDomListener(window, 'load', initialize);

var ajaxGet = new XMLHttpRequest();
var updater = setInterval(function() {
	ajaxGet.open('GET', '/getall', false);
	ajaxGet.send();
	if (ajaxGet.readyState==4 && ajaxGet.status==200) {
		var simData = JSON.parse(ajaxGet.responseText);
		var planePos = new google.maps.LatLng(simData.Plane_Latitude, simData.Plane_Longitude);
		if (marker) {
			marker.setPosition(planePos);
			//map.setCenter(planePos);
			var heading = Math.round(simData.Plane_Heading_Degrees_True);
			marker.setIcon(airplaneIcons[heading]);
			marker.setTitle('HDG=' + heading + '\nALT=' + Math.round(simData.Plane_Altitude) + '\nSPD=' + Math.round(simData.Airspeed_Indicated));
		}
	}
}, 33);

</script>
</head>

<body>
	<div id="map-canvas"></div>
	<canvas id="icon"></canvas>
</body>

</html>
